CREATE TABLE TRADES_BY_WOMEN_STATS3 WITH (CLEANUP_POLICY='compact', KAFKA_TOPIC='pksqlc-nwz68vTRADES_BY_WOMEN_STATS3', PARTITIONS=6, REPLICAS=3, RETENTION_MS=604800000) AS 

SELECT
  T.USERID USERID,
  COUNT(T.USERID) `Trades Executed`,
  SUM(T.QUANTITY) `Quantity Traded`,
  AVG(T.QUANTITY) `Average Trade`,
  MAX(T.QUANTITY) `Largest Trade`
FROM SAMPLE_DATA_USERS U

INNER JOIN SAMPLE_DATA_STOCK_TRADES T 
WITHIN 60 SECONDS GRACE PERIOD 10 SECONDS ON ((U.USERID = T.USERID))

WHERE (U.GENDER = 'FEMALE')

GROUP BY T.USERID

EMIT CHANGES;